---
title: "STAT155-PROJECT3"
author: "Jenny Li, Xiang Li"
date: "2021/12/6"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-packages, message = FALSE, echo=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(ggmosaic)
library(broom)
library(knitr)
```

> Introduction to Topic

Sport, as an area receiving increased attention, responds as a result of increased awareness of people to their physical health, especially during the weird year 2020, where the pandemic changes the way of living as well as sport. Some sports benefit from it, some in alternative. For example, powerlifting is a strength sport that consists of three attempts at maximal weight on three lifts: squat, bench press, and deadlift. At the same time, a perfect self-training exercise while staying at home during the pandemic. When talking about powerlifting, one question always arises and is curious by the people is that “what actually would the weight of the lifters affect the weight they are lifting?”. In this report, we will build up a linear regression model including the bodyweight of the lifters, the total weight they can lift, and other possible factors to discuss this question.

> Research Questions

In order to be more specific and accurate, we decided to restructure our research question into:  What is the impact of the body weight of the lifters on the total weight they successfully lifted? The response variable in this question would be the total weight the lifters successfully lifted, The term “total weight” refers to the total of best squat in the three lifts-- squat, bench press, and deadlift-- respectively. The two explanatory variables would be the bodyweight of the lifters and the age. The body weight would be a direct factor to the total weight, which, at the same time, provided the answer to our research question. On the other hand, age can be a confounding variable, or at least a precision variable that is worth including as an explanatory variable: we believe that age is associated with the total weight, and not caused by body weight.

> Data

> Context

In this report, we’ll use data from the OpenPowerlifting database as of April 2019. OpenPowerlifting is creating a public-domain archive of power lifting history. Power lifting is a sport in which competitors compete to lift the most weight for their class in three separate barbell lifts: the Squat, Bench, and Dead lift. The data is represented by openpowerlifting.csv, which includes all information on the meets (competitions) as well as the competitors who attended those meets worldwide. This dataset tracks 2554800 entries for 668172 lifters from 39909 meets. All the data in the dataset are collected by a team of about eight power lifters from official results posted on federations’ websites. Find more information about the dataset and download the openpowerlifting.csv file on Kaggle: https://www.kaggle.com/open-powerlifting/powerlifting-database. 

```{r load-data, message = FALSE}
# loading dataset
lifting <- read_csv (file = "openpowerlifting.csv")
```

> Cleaning

We first filter out all invalid data, which contains NA, in “TotalKg”, “BodyweightKg”, and “Age”. As the diagram shows, the lifters’ ages are concentrated from 18 to 40. Therefore, since the lifters’ ages are mainly distributed between 18 and 40,  we filter the dataset, in this particular dataset--participants, leaving only the lifters’ data between 18 and 40. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Filter data age and body weight
lifting1 <- lifting[!is.na(lifting$TotalKg), ]
lifting1 <- lifting1[!is.na(lifting1$BodyweightKg),]
lifting1 <- lifting1[!is.na(lifting1$AgeClass),]

# Distribution of age
lifting1%>%
  ggplot(aes(x=Age))+
  geom_histogram(binwidth = 2,color='lightblue', fill='steelblue')+
  ylab('Count') + 
  xlab('Age') + 
  theme_classic() + 
  ggtitle('Distribution of Age Among the Lifters')

# Filter data age 
lifting1 <- lifting1 %>%
  filter(AgeClass %in% c("18-19", "20-23", "24-34", "35-39", "40-44"))
```

> Linear Regression

> Exploratory Data Analysis

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache = TRUE}
lifting1 %>%
  ggplot(aes(x = BodyweightKg, y = TotalKg, color = Sex, group = AgeClass)) +
  geom_point() + 
  geom_smooth(method = 'lm', se = FALSE, color = "black") +
  facet_wrap(~ AgeClass) +
  labs(x = "Body weight (kg)", y = "Total Weight Lifting (kg)") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        legend.position = "none") +
  scale_color_brewer(palette = "Paired") +
  theme_bw() 

lifting1 %>%
  summarize(cor(TotalKg, BodyweightKg))
```

> Model Creation

>Research Question: What is the impact of the body weight of the lifters on the total weight they successfully lifted?

$$[ TotalWeightLifting | BodyWeight, AgeClass, Sex ] = \beta_0 + \beta_1 bodyweight + \beta_2 sexM + \beta_3 ageAgeClass20-23 + \beta_4 AgeClass24-34 + \beta_5 AgeClass35-39 + \beta_6 AgeClass40-44$$
```{r}
mod1 <- lm(with(TotalKg ~ BodyweightKg + Sex + AgeClass, data = lifting1))
coef(mod1)
glance(mod1)

# mod2 <- lm(with(TotalKg ~ BodyweightKg + Sex + AgeClass+BodyweightKg:Sex, data = lifting1))
# coef(mod2)
# glance(mod2)
```


> Fitted Model

```{r}
tidy(mod1)
confint(mod1)
```

> Model Interpretation

> Model Evaluation

```{r}
# residual plot
augment(mod1)
augment(mod1) %>%
    ggplot(aes(x = .fitted, y = .resid)) +
    geom_point(color = "steelblue", alpha = 1/10) +
    geom_smooth(se = FALSE, color = "gold") +
    geom_hline(yintercept = 0, color = "darkslategray") +
    theme_classic() +
    labs(x = "Fitted values", y = "Residuals", title = 'Residuals vs Fitted Values (Model 1)')

augment(mod1) %>%
  ggplot(aes(y = .resid, x = BodyweightKg)) + 
  geom_point(color = "steelblue", alpha = 1/10) + 
  geom_smooth(se = FALSE, color = "gold") + 
  geom_hline(yintercept = 0, color = "darkslategray") + 
  labs(x = 'Body Weight (kg)', y = 'Residuals', title = 'Residuals vs Explanatory Variable (Model 1)') + 
  theme_classic()
```

> Conclusion 

> General Takeaways

> Limitation

> Appendix
> Works Cited

OpenPowerlifting. “Powerlifting Database.” Kaggle, April 25, 2019. https://www.kaggle.com/open-powerlifting/powerlifting-database.

> R Code
